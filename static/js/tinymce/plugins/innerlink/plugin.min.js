tinymce.PluginManager.add('innerlink', function (editor) {
    var showDialog = function () {
        var dom = editor.dom;
        editor.settings.innerlink_dlg.open(function (links, type) {
            for (var i in links) {
                editor.insertContent(dom.createHTML('p', {}, dom.createHTML('a', {
                    href: '/' + links[i].id,
                    type: links[i].type ? links[i].type : type,
                    target: null,
                    rel: null,
                    "class": 'innerlink'
                }, dom.encode(links[i].title))));
            }
        });
    };
    editor.addButton('innerlink', {
        icon: 'link',
        tooltip: '插入应用内素材链接',
        shortcut: 'Ctrl+K',
        onclick: showDialog
    });
    editor.addShortcut('Ctrl+K', '', showDialog);
    this.showDialog = showDialog;
    editor.addMenuItem('innerlink', {
        icon: 'link',
        text: '插入应用内素材链接',
        shortcut: 'Ctrl+K',
        onclick: showDialog,
        context: 'insert',
        prependToContext: true
    });
});
